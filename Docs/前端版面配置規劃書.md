# 代理管理系統前端版面配置規劃書

## 1. 專案概述

### 1.1 專案背景
代理管理系統需要一個現代化、直觀的前端界面，用於管理和監控代理IP的獲取、驗證、分類和生命週期管理。本規劃書詳細說明了前端系統的設計理念、功能模組、技術架構和實施方案。

### 1.2 設計目標
- **用戶體驗優先**：提供直觀、響應式的用戶界面
- **功能完整性**：涵蓋代理管理的所有核心功能
- **數據可視化**：通過圖表和儀表板展示關鍵指標
- **實時監控**：支持實時狀態更新和通知
- **移動適配**：確保在各種設備上的良好體驗

## 2. 技術架構

### 2.1 前端技術棧
```
框架: React 18 + TypeScript
狀態管理: Redux Toolkit + RTK Query
UI組件庫: Ant Design 5.x
圖表庫: Apache ECharts 5.x
樣式方案: Tailwind CSS + CSS Modules
構建工具: Vite 4.x
路由: React Router 6.x
測試: Jest + React Testing Library
```

### 2.2 後端API架構
```
API框架: FastAPI (Python)
數據格式: RESTful API + WebSocket
認證: JWT Token
文檔: OpenAPI/Swagger
```

### 2.3 項目結構
```
src/
├── components/          # 可重用組件
│   ├── common/         # 通用組件
│   ├── charts/         # 圖表組件
│   └── ui/            # UI組件
├── pages/             # 頁面組件
├── hooks/             # 自定義Hooks
├── services/          # API服務
├── store/             # Redux Store
├── utils/             # 工具函數
├── types/             # TypeScript類型定義
└── assets/            # 靜態資源
```

## 3. 頁面結構設計

### 3.1 整體佈局

#### 3.1.1 導航結構
```
主導航菜單:
├── 儀表板 (Dashboard)
├── 代理管理 (Proxy Management)
│   ├── 代理列表
│   ├── 獲取設置
│   └── 驗證設置
├── 生命週期 (Lifecycle)
│   ├── 狀態追蹤
│   ├── 統計分析
│   └── 歷史記錄
├── 自動化 (Automation)
│   ├── 任務調度
│   ├── 執行日誌
│   └── 配置管理
├── 報告中心 (Reports)
│   ├── 實時報告
│   ├── 歷史報告
│   └── 導出設置
└── 系統設置 (Settings)
    ├── 基本設置
    ├── 通知配置
    └── 用戶管理
```

#### 3.1.2 佈局框架
```
┌─────────────────────────────────────────────────────────────┐
│ Header (頂部導航欄)                                        │
├─────────────┬───────────────────────────────────────────────┤
│             │                                               │
│ Sidebar     │ Main Content Area                             │
│ (左側菜單)  │ (主要內容區域)                                │
│             │                                               │
│             │ ┌───────────────────────────────────────────┐ │
│             │ │ Page Header (頁面標題和操作區)           │ │
│             │ ├───────────────────────────────────────────┤ │
│             │ │                                           │
│             │ │ Content Area (內容區域)                   │ │
│             │ │                                           │ │
│             │ └───────────────────────────────────────────┘ │
└─────────────┴───────────────────────────────────────────────┘
```

### 3.2 具體頁面設計

#### 3.2.1 儀表板 (Dashboard)

**URL路徑**: `/dashboard`

**主要功能**:
- 系統狀態總覽
- 關鍵指標展示
- 實時圖表
- 最近活動
- 快速操作

**頁面佈局**:
```
┌─────────────────────────────────────────────────────────────┐
│ Dashboard - 系統總覽                                       │
├─────────────────────────────────────────────────────────────┤
│                                                             │
│ [統計卡片區域]                                               │
│ ┌──────────┬──────────┬──────────┬──────────┐          │
│ │有效代理數│無效代理數│獲取成功│驗證成功│          │
│ │  1,234   │   567    │  89%   │  76%   │          │
│ └──────────┴──────────┴──────────┴──────────┘          │
│                                                             │
│ [圖表區域]                                                   │
│ ┌─────────────────────┬──────────────────────┐          │
│ │ 代理來源分布圖       │ 代理狀態趨勢圖       │          │
│ │                     │                      │          │
│ │   [餅圖]            │   [折線圖]           │          │
│ └─────────────────────┴──────────────────────┘          │
│                                                             │
│ [活動日誌]                                                   │
│ ┌───────────────────────────────────────────────┐          │
│ │ 最近活動                                      │          │
│ │ 2024-01-20 10:30 獲取 500 個代理             │          │
│ │ 2024-01-20 09:45 驗證 200 個代理             │          │
│ │ 2024-01-20 08:00 生成報告                    │          │
│ └───────────────────────────────────────────────┘          │
└─────────────────────────────────────────────────────────────┘
```

**組件說明**:
- **統計卡片**: 使用 Ant Design 的 Statistic 組件，顯示核心指標
- **圖表區域**: 使用 ECharts 展示數據趨勢和分布
- **活動日誌**: 使用 Table 組件展示最近的操作記錄

#### 3.2.2 代理列表頁面 (Proxy List)

**URL路徑**: `/proxies`

**主要功能**:
- 代理列表展示
- 高級搜索和篩選
- 批量操作
- 導出功能
- 詳細信息查看

**頁面佈局**:
```
┌─────────────────────────────────────────────────────────────┐
│ 代理管理 - 代理列表                                          │
├─────────────────────────────────────────────────────────────┤
│                                                             │
│ [搜索和篩選區域]                                             │
│ ┌──────────────────────────────────────────────────────┐    │
│ │ [搜索框] [狀態篩選] [類型篩選] [國家篩選] [搜索按鈕] │    │
│ └──────────────────────────────────────────────────────┘    │
│                                                             │
│ [操作按鈕區域]                                               │
│ [刷新] [批量驗證] [批量刪除] [導出] [獲取新代理]             │
│                                                             │
│ [數據表格區域]                                               │
│ ┌──────────────────────────────────────────────────────────┐ │
│ │ IP地址 │ 端口 │ 類型 │ 國家 │ 狀態 │ 響應時間 │ 操作 │ │
│ ├────────┼──────┼──────┼──────┼──────┼──────────┼──────┤ │
│ │1.2.3.4 │ 8080 │ HTTP │ 美國 │ 有效 │  1.2s   │ [驗證]│ │
│ │5.6.7.8 │ 3128 │HTTPS │ 日本 │ 無效 │   -     │ [刪除]│ │
│ │ ...    │ ...  │ ...  │ ...  │ ...  │  ...     │ ...  │ │
│ └──────────────────────────────────────────────────────────┘ │
│                                                             │
│ [分頁控制]                                                   │
│                    [上一頁] 1 2 3 ... [下一頁]              │
└─────────────────────────────────────────────────────────────┘
```

**組件說明**:
- **搜索區域**: 使用 Form 和 Select 組件實現多條件篩選
- **操作按鈕**: 使用 Button 組件，支持批量操作
- **數據表格**: 使用 Table 組件，支持排序、分頁、選擇
- **狀態標籤**: 使用 Tag 組件顯示代理狀態（綠色=有效，紅色=無效，黃色=暫時無效）

#### 3.2.3 代理獲取設置 (Proxy Fetch Settings)

**URL路徑**: `/proxies/fetch-settings`

**主要功能**:
- 數據源配置
- 獲取策略設置
- 定時任務配置
- 高級選項

**頁面佈局**:
```
┌─────────────────────────────────────────────────────────────┐
│ 代理管理 - 獲取設置                                          │
├─────────────────────────────────────────────────────────────┤
│                                                             │
│ [基本設置卡片]                                               │
│ ┌──────────────────────────────────────────────────────┐    │
│ │ 獲取間隔: [每6小時] 獲取數量: [1000] 重試次數: [3]     │    │
│ │ 超時時間: [30秒] 並發數量: [50]                       │    │
│ └──────────────────────────────────────────────────────┘    │
│                                                             │
│ [數據源配置卡片]                                             │
│ ┌──────────────────────────────────────────────────────┐    │
│ │ ☑ Proxifly API  [配置按鈕]                          │    │
│ │ ☑ Free Proxy List  [配置按鈕]                       │    │
│ │ ☐ ProxyScrape API  [配置按鈕]                       │    │
│ │ [添加新數據源]                                       │    │
│ └──────────────────────────────────────────────────────┘    │
│                                                             │
│ [高級選項卡片]                                               │
│ ┌──────────────────────────────────────────────────────┐    │
│ │ 國家過濾: [多選框] 代理類型: [多選框]               │    │
│ │ 匿名級別: [下拉選擇] 響應時間限制: [輸入框]         │    │
│ │ 保存設置] [重置設置] [測試連接]                      │    │
│ └──────────────────────────────────────────────────────┘    │
└─────────────────────────────────────────────────────────────┘
```

#### 3.2.4 生命週期追蹤 (Lifecycle Tracking)

**URL路徑**: `/lifecycle/tracking`

**主要功能**:
- 代理狀態變化追蹤
- 生命週期可視化
- 歷史記錄查詢
- 趨勢分析

**頁面佈局**:
```
┌─────────────────────────────────────────────────────────────┐
│ 生命週期 - 狀態追蹤                                          │
├─────────────────────────────────────────────────────────────┤
│                                                             │
│ [時間篩選器]                                                 │
│ [開始時間] [結束時間] [代理IP] [狀態] [搜索]               │
│                                                             │
│ [生命週期圖表]                                               │
│ ┌──────────────────────────────────────────────────────┐    │
│ │                                                      │    │
│ │     [甘特圖展示代理狀態變化時間線]                    │    │
│ │                                                      │    │
│ └──────────────────────────────────────────────────────┘    │
│                                                             │
│ [狀態變化表格]                                               │
│ ┌──────────────────────────────────────────────────────┐    │
│ │ 時間 │ 代理IP │ 舊狀態 │ 新狀態 │ 持續時間 │ 備註 │ │
│ ├──────┼────────┼────────┼────────┼──────────┼──────┤ │
│ │10:30 │1.2.3.4 │ 未測試 │ 有效   │   -     │ 手動 │ │
│ │12:45 │1.2.3.4 │ 有效   │暫時無效│ 2.25h   │超時  │ │
│ │ ...  │ ...    │ ...    │ ...    │  ...    │ ...  │ │
│ └──────────────────────────────────────────────────────┘    │
└─────────────────────────────────────────────────────────────┘
```

#### 3.2.5 自動化任務調度 (Automation Scheduler)

**URL路徑**: `/automation/scheduler`

**主要功能**:
- 任務列表管理
- 定時任務配置
- 執行日誌查看
- 任務啟停控制

**頁面佈局**:
```
┌─────────────────────────────────────────────────────────────┐
│ 自動化 - 任務調度                                            │
├─────────────────────────────────────────────────────────────┤
│                                                             │
│ [任務控制區域]                                               │
│ [啟動所有任務] [停止所有任務] [立即執行] [刷新狀態]         │
│                                                             │
│ [任務列表]                                                   │
│ ┌──────────────────────────────────────────────────────┐    │
│ │ 任務名稱 │ 狀態 │ 下次執行 │ 最後執行 │ 操作 │     │    │
│ ├──────────┼──────┼──────────┼──────────┼──────┤     │    │
│ │獲取代理  │運行中│ 14:00    │ 08:00    │[停止]│     │    │
│ │驗證代理  │運行中│ 14:30    │ 11:30    │[停止]│     │    │
│ │清理任務  │停止 │ 15:00    │ 昨天     │[啟動]│     │    │
│ │生成報告  │運行中│ 16:00    │ 10:00    │[停止]│     │    │
│ └──────────────────────────────────────────────────────┘    │
│                                                             │
│ [執行日誌]                                                   │
│ ┌──────────────────────────────────────────────────────┐    │
│ │ 時間 │ 任務 │ 狀態 │ 持續時間 │ 詳細信息 │             │    │
│ ├──────┼──────┼──────┼──────────┼──────────┤             │    │
│ │13:30 │獲取代理│成功  │ 2.5分鐘  │獲取500個 │             │    │
│ │13:00 │驗證代理│成功  │ 5.2分鐘  │驗證300個 │             │    │
│ │ ...  │ ...  │ ...  │  ...     │  ...     │             │    │
│ └──────────────────────────────────────────────────────┘    │
└─────────────────────────────────────────────────────────────┘
```

#### 3.2.6 報告中心 (Reports Center)

**URL路徑**: `/reports`

**主要功能**:
- 報告列表
- 報告預覽
- 報告導出
- 自定義報告生成

**頁面佈局**:
```
┌─────────────────────────────────────────────────────────────┐
│ 報告中心 - 報告列表                                          │
├─────────────────────────────────────────────────────────────┤
│                                                             │
│ [報告生成區域]                                               │
│ [報告類型] [時間範圍] [格式選擇] [生成報告]                 │
│                                                             │
│ [報告列表]                                                   │
│ ┌──────────────────────────────────────────────────────┐    │
│ │ 報告名稱 │ 類型 │ 生成時間 │ 大小 │ 操作 │         │    │
│ ├──────────┼──────┼──────────┼──────┼──────┤         │    │
│ │每日報告  │ JSON │ 今天10:00│ 2.3MB│[下載]│         │    │
│ │週報告    │ CSV  │ 昨天14:00│ 5.1MB│[下載]│         │    │
│ │生命週期報│ JSON │ 前天08:00│ 1.8MB│[下載]│         │    │
│ │ ...      │ ...  │  ...     │ ...  │ ...  │         │    │
│ └──────────────────────────────────────────────────────┘    │
│                                                             │
│ [報告預覽]                                                   │
│ ┌──────────────────────────────────────────────────────┐    │
│ │                                                     │    │
│ │     [選中報告的內容預覽]                              │    │
│ │                                                     │    │
│ └──────────────────────────────────────────────────────┘    │
└─────────────────────────────────────────────────────────────┘
```

#### 3.2.7 系統設置 (Settings)

**URL路徑**: `/settings`

**主要功能**:
- 基本設置
- 通知配置
- API配置
- 日誌設置
- 系統信息

**頁面佈局**:
```
┌─────────────────────────────────────────────────────────────┐
│ 系統設置                                                     │
├─────────────┬───────────────────────────────────────────────┤
│             │                                               │
│ 設置菜單    │ 設置內容區域                                   │
│             │                                               │
│ [基本設置]  │ ┌──────────────────────────────────────────┐ │
│ [通知配置]  │ │ 基本設置                                   │ │
│ [API配置]   │ │                                            │ │
│ [日誌設置]  │ │ 系統名稱: [輸入框]                        │ │
│ [系統信息]  │ │ 時區設置: [下拉選擇]                      │ │
│             │ │ 語言設置: [下拉選擇]                      │ │
│             │ │ 主題模式: [開關] 深色模式                │ │
│             │ │                                            │ │
│             │ │ [保存設置] [重置設置]                      │ │
│             │ └──────────────────────────────────────────┘ │
└─────────────┴───────────────────────────────────────────────┘
```

## 4. 組件設計規範

### 4.1 通用組件

#### 4.1.1 頁面頭部組件 (PageHeader)
```typescript
interface PageHeaderProps {
  title: string;
  breadcrumbs?: BreadcrumbItem[];
  actions?: React.ReactNode[];
  description?: string;
}

// 使用示例
<PageHeader
  title="代理列表"
  breadcrumbs={[
    { title: '首頁', path: '/' },
    { title: '代理管理', path: '/proxies' },
    { title: '代理列表' }
  ]}
  actions={[
    <Button key="refresh" icon={<ReloadOutlined />}>刷新</Button>,
    <Button key="export" icon={<ExportOutlined />}>導出</Button>
  ]}
/>
```

#### 4.1.2 搜索表單組件 (SearchForm)
```typescript
interface SearchFormProps {
  fields: SearchField[];
  onSearch: (values: any) => void;
  onReset?: () => void;
  loading?: boolean;
}

interface SearchField {
  name: string;
  label: string;
  type: 'input' | 'select' | 'date' | 'number';
  options?: SelectOption[];
  placeholder?: string;
}
```

#### 4.1.3 數據表格組件 (DataTable)
```typescript
interface DataTableProps<T> {
  columns: TableColumn<T>[];
  dataSource: T[];
  loading?: boolean;
  pagination?: PaginationConfig;
  rowSelection?: RowSelectionConfig;
  onRowClick?: (record: T) => void;
  scroll?: { x?: number; y?: number };
}
```

### 4.2 圖表組件

#### 4.2.1 統計卡片組件 (StatCard)
```typescript
interface StatCardProps {
  title: string;
  value: number | string;
  prefix?: React.ReactNode;
  suffix?: React.ReactNode;
  trend?: 'up' | 'down';
  trendValue?: string;
  color?: string;
  loading?: boolean;
}
```

#### 4.2.2 餅圖組件 (PieChart)
```typescript
interface PieChartProps {
  data: { name: string; value: number; color?: string }[];
  title?: string;
  height?: number;
  showLabel?: boolean;
  legendPosition?: 'top' | 'bottom' | 'left' | 'right';
}
```

#### 4.2.3 折線圖組件 (LineChart)
```typescript
interface LineChartProps {
  data: { x: string; y: number; series?: string }[];
  xAxis: { name: string; type: 'category' | 'time' | 'value' };
  yAxis: { name: string; type: 'category' | 'time' | 'value' };
  title?: string;
  height?: number;
  smooth?: boolean;
  area?: boolean;
}
```

### 4.3 業務組件

#### 4.3.1 代理狀態標籤 (ProxyStatusTag)
```typescript
interface ProxyStatusTagProps {
  status: 'valid' | 'invalid' | 'temp_invalid' | 'untested';
  size?: 'small' | 'middle' | 'large';
  showText?: boolean;
}

// 狀態對應
const statusMap = {
  valid: { color: 'success', text: '有效' },
  invalid: { color: 'error', text: '無效' },
  temp_invalid: { color: 'warning', text: '暫時無效' },
  untested: { color: 'default', text: '未測試' }
};
```

#### 4.3.2 代理信息卡片 (ProxyInfoCard)
```typescript
interface ProxyInfoCardProps {
  proxy: ProxyInfo;
  showActions?: boolean;
  onValidate?: (proxy: ProxyInfo) => void;
  onDelete?: (proxy: ProxyInfo) => void;
  onEdit?: (proxy: ProxyInfo) => void;
}

interface ProxyInfo {
  id: string;
  ip: string;
  port: number;
  type: 'http' | 'https' | 'socks4' | 'socks5';
  country: string;
  status: ProxyStatus;
  responseTime?: number;
  lastValidated?: string;
  anonymity?: 'transparent' | 'anonymous' | 'elite';
}
```

## 5. 狀態管理設計

### 5.1 Redux Store結構

```typescript
interface RootState {
  auth: AuthState;
  proxies: ProxyState;
  lifecycle: LifecycleState;
  automation: AutomationState;
  reports: ReportsState;
  settings: SettingsState;
  ui: UIState;
}

// 代理狀態
interface ProxyState {
  list: ProxyInfo[];
  loading: boolean;
  pagination: PaginationInfo;
  filters: ProxyFilters;
  selectedIds: string[];
  statistics: ProxyStatistics;
}

// 生命週期狀態
interface LifecycleState {
  trackingData: LifecycleEvent[];
  analytics: LifecycleAnalytics;
  filters: LifecycleFilters;
  loading: boolean;
}

// 自動化狀態
interface AutomationState {
  tasks: TaskInfo[];
  schedulerStatus: 'running' | 'stopped' | 'error';
  logs: TaskLog[];
  config: AutomationConfig;
}
```

### 5.2 API服務設計

```typescript
// 代理API服務
class ProxyService {
  async getProxies(params: ProxyQueryParams): Promise<PaginatedResponse<ProxyInfo>>;
  async validateProxy(id: string): Promise<ValidationResult>;
  async validateBatch(ids: string[]): Promise<BatchValidationResult>;
  async deleteProxy(id: string): Promise<void>;
  async exportProxies(format: ExportFormat, filters?: ProxyFilters): Promise<Blob>;
  async fetchProxies(config: FetchConfig): Promise<FetchResult>;
}

// 生命週期API服務
class LifecycleService {
  async getTrackingData(filters: TrackingFilters): Promise<LifecycleEvent[]>;
  async getAnalytics(params: AnalyticsParams): Promise<LifecycleAnalytics>;
  async exportReport(format: ReportFormat, range: DateRange): Promise<Blob>;
}

// 自動化API服務
class AutomationService {
  async getTasks(): Promise<TaskInfo[]>;
  async startScheduler(): Promise<void>;
  async stopScheduler(): Promise<void>;
  async runTask(taskId: string): Promise<void>;
  async getLogs(params: LogQueryParams): Promise<PaginatedResponse<TaskLog>>;
  async updateConfig(config: AutomationConfig): Promise<void>;
}
```

## 6. 用戶體驗設計

### 6.1 交互設計原則

1. **即時反饋**: 所有操作都應該有明確的反饋
2. **加載狀態**: 適當的加載動畫和進度指示
3. **錯誤處理**: 友好的錯誤提示和解決方案
4. **確認對話框**: 重要操作需要二次確認
5. **快捷操作**: 提供快捷鍵和右鍵菜單

### 6.2 響應式設計

#### 6.2.1 斷點設計
```css
/* 斷點定義 */
@media (min-width: 576px)  { /* 手機橫屏 */ }
@media (min-width: 768px)  { /* 平板 */ }
@media (min-width: 992px)  { /* 小屏幕桌面 */ }
@media (min-width: 1200px) { /* 大屏幕桌面 */ }
@media (min-width: 1600px) { /* 超大屏幕 */ }
```

#### 6.2.2 響應式組件
- **導航菜單**: 移動端使用抽屜式菜單
- **表格**: 支持橫向滾動和卡片式布局
- **表單**: 根據屏幕大小調整列數
- **圖表**: 自適應容器大小

### 6.3 主題和樣式

#### 6.3.1 色彩系統
```css
/* 主色調 */
--primary-color: #1890ff;
--success-color: #52c41a;
--warning-color: #faad14;
--error-color: #f5222d;

/* 中性色 */
--text-color: rgba(0, 0, 0, 0.85);
--text-color-secondary: rgba(0, 0, 0, 0.65);
--disabled-color: rgba(0, 0, 0, 0.25);
--border-color: #d9d9d9;
--background-color: #f5f5f5;

/* 深色模式 */
--dark-bg-color: #141414;
--dark-text-color: rgba(255, 255, 255, 0.85);
```

#### 6.3.2 字體系統
```css
/* 字體大小 */
--font-size-xs: 12px;
--font-size-sm: 14px;
--font-size-base: 14px;
--font-size-lg: 16px;
--font-size-xl: 20px;

/* 字重 */
--font-weight-normal: 400;
--font-weight-medium: 500;
--font-weight-bold: 600;

/* 行高 */
--line-height-base: 1.5715;
--line-height-sm: 1.5;
--line-height-lg: 1.5;
```

## 7. 性能優化

### 7.1 代碼分割
```typescript
// 路由級別代碼分割
const Dashboard = lazy(() => import('@/pages/Dashboard'));
const ProxyList = lazy(() => import('@/pages/ProxyList'));
const Lifecycle = lazy(() => import('@/pages/Lifecycle'));

// 組件級別代碼分割
const ChartComponents = lazy(() => import('@/components/Charts'));
```

### 7.2 數據緩存
```typescript
// RTK Query 緩存配置
const api = createApi({
  reducerPath: 'api',
  baseQuery: fetchBaseQuery({ baseUrl: '/api' }),
  tagTypes: ['Proxy', 'Lifecycle', 'Task'],
  endpoints: (builder) => ({
    getProxies: builder.query({
      query: (params) => ({ url: 'proxies', params }),
      providesTags: ['Proxy'],
      keepUnusedDataFor: 60, // 緩存60秒
    }),
  }),
});
```

### 7.3 虛擬滾動
```typescript
// 大量數據列表使用虛擬滾動
import { VariableSizeList } from 'react-window';

const VirtualizedTable = ({ data, rowHeight, height }) => {
  return (
    <VariableSizeList
      height={height}
      itemCount={data.length}
      itemSize={(index) => rowHeight(data[index])}
      itemData={data}
    >
      {Row}
    </VariableSizeList>
  );
};
```

## 8. 安全設計

### 8.1 認證和授權
```typescript
// JWT Token 管理
class AuthService {
  private token: string | null = null;
  
  setToken(token: string) {
    this.token = token;
    localStorage.setItem('token', token);
  }
  
  getToken(): string | null {
    if (!this.token) {
      this.token = localStorage.getItem('token');
    }
    return this.token;
  }
  
  removeToken() {
    this.token = null;
    localStorage.removeItem('token');
  }
  
  isAuthenticated(): boolean {
    const token = this.getToken();
    if (!token) return false;
    
    try {
      const payload = JSON.parse(atob(token.split('.')[1]));
      return payload.exp > Date.now() / 1000;
    } catch {
      return false;
    }
  }
}
```

### 8.2 權限控制
```typescript
// 路由守衛
const PrivateRoute = ({ children, requiredRole }) => {
  const { user } = useAuth();
  
  if (!user) {
    return <Navigate to="/login" />;
  }
  
  if (requiredRole && !user.roles.includes(requiredRole)) {
    return <Navigate to="/403" />;
  }
  
  return children;
};

// 組件級別權限控制
const PermissionWrapper = ({ permission, children }) => {
  const { hasPermission } = usePermission();
  
  if (!hasPermission(permission)) {
    return null;
  }
  
  return children;
};
```

### 8.3 輸入驗證
```typescript
// 表單輸入驗證
const proxyValidationSchema = yup.object().shape({
  ip: yup.string()
    .required('IP地址不能為空')
    .matches(/^\d+\.\d+\.\d+\.\d+$/, 'IP地址格式不正確'),
  port: yup.number()
    .required('端口不能為空')
    .min(1, '端口必須大於0')
    .max(65535, '端口不能超過65535'),
  type: yup.string()
    .oneOf(['http', 'https', 'socks4', 'socks5'], '代理類型不正確')
    .required('代理類型不能為空'),
});
```

## 9. 測試策略

### 9.1 單元測試
```typescript
// 組件單元測試示例
describe('ProxyStatusTag', () => {
  it('should render valid status correctly', () => {
    render(<ProxyStatusTag status="valid" />);
    expect(screen.getByText('有效')).toBeInTheDocument();
    expect(screen.getByRole('status')).toHaveClass('ant-tag-success');
  });
  
  it('should render invalid status correctly', () => {
    render(<ProxyStatusTag status="invalid" />);
    expect(screen.getByText('無效')).toBeInTheDocument();
    expect(screen.getByRole('status')).toHaveClass('ant-tag-error');
  });
});
```

### 9.2 集成測試
```typescript
// API集成測試
describe('ProxyService', () => {
  it('should fetch proxies successfully', async () => {
    const mockResponse = {
      data: mockProxies,
      total: 100,
      page: 1,
      pageSize: 10,
    };
    
    server.use(
      rest.get('/api/proxies', (req, res, ctx) => {
        return res(ctx.json(mockResponse));
      })
    );
    
    const result = await proxyService.getProxies({ page: 1, pageSize: 10 });
    expect(result.data).toEqual(mockProxies);
    expect(result.total).toBe(100);
  });
});
```

### 9.3 E2E測試
```typescript
// Playwright E2E測試示例
test.describe('Proxy Management', () => {
  test('should display proxy list', async ({ page }) => {
    await page.goto('/proxies');
    await expect(page.locator('table')).toBeVisible();
    await expect(page.locator('.ant-table-row')).toHaveCount(10);
  });
  
  test('should validate proxy', async ({ page }) => {
    await page.goto('/proxies');
    await page.click('button:has-text("驗證")').first();
    await expect(page.locator('.ant-message-success')).toBeVisible();
  });
});
```

## 10. 部署和運維

### 10.1 構建配置
```typescript
// Vite配置優化
export default defineConfig({
  build: {
    rollupOptions: {
      output: {
        manualChunks: {
          vendor: ['react', 'react-dom', 'react-router-dom'],
          ui: ['antd', '@ant-design/icons'],
          charts: ['echarts', 'echarts-for-react'],
          utils: ['lodash', 'dayjs', 'axios'],
        },
      },
    },
    chunkSizeWarningLimit: 1000,
  },
  
  plugins: [
    react(),
    compression(),
    visualizer({
      open: true,
      gzipSize: true,
      brotliSize: true,
    }),
  ],
});
```

### 10.2 環境配置
```typescript
// 環境變量配置
interface ImportMetaEnv {
  readonly VITE_API_BASE_URL: string;
  readonly VITE_APP_TITLE: string;
  readonly VITE_APP_VERSION: string;
  readonly VITE_ENABLE_MOCK: string;
  readonly VITE_SENTRY_DSN: string;
}

interface ImportMeta {
  readonly env: ImportMetaEnv;
}
```

### 10.3 Docker部署
```dockerfile
# Dockerfile
FROM node:18-alpine as builder

WORKDIR /app
COPY package*.json ./
RUN npm ci --only=production

COPY . .
RUN npm run build

FROM nginx:alpine
COPY --from=builder /app/dist /usr/share/nginx/html
COPY nginx.conf /etc/nginx/nginx.conf

EXPOSE 80
CMD ["nginx", "-g", "daemon off;"]
```

### 10.4 監控和日誌
```typescript
// Sentry錯誤監控
Sentry.init({
  dsn: import.meta.env.VITE_SENTRY_DSN,
  environment: import.meta.env.MODE,
  release: import.meta.env.VITE_APP_VERSION,
  integrations: [
    new Sentry.BrowserTracing({
      routingInstrumentation: Sentry.reactRouterV6Instrumentation(
        React.useEffect,
        useLocation,
        useNavigationType,
        createRoutesFromChildren,
        matchRoutes
      ),
    }),
  ],
  tracesSampleRate: 1.0,
});
```

## 11. 開發計劃

### 11.1 第一階段 (基礎框架)
- [ ] 項目初始化
- [ ] 路由和佈局搭建
- [ ] 狀態管理配置
- [ ] API服務封裝
- [ ] 基礎組件開發

### 11.2 第二階段 (核心功能)
- [ ] 儀表板開發
- [ ] 代理列表頁面
- [ ] 代理獲取設置
- [ ] 基礎數據可視化

### 11.3 第三階段 (高級功能)
- [ ] 生命週期管理
- [ ] 自動化調度
- [ ] 高級搜索和篩選
- [ ] 報告中心

### 11.4 第四階段 (優化和完善)
- [ ] 響應式設計優化
- [ ] 性能優化
- [ ] 測試覆蓋
- [ ] 文檔完善

### 11.5 第五階段 (部署和維護)
- [ ] 生產環境部署
- [ ] 監控配置
- [ ] 用戶培訓
- [ ] 持續維護

## 12. 風險評估和應對

### 12.1 技術風險
| 風險 | 影響 | 概率 | 應對措施 |
|------|------|------|----------|
| 第三方庫兼容性問題 | 高 | 中 | 提前測試，準備替代方案 |
| 性能瓶頸 | 高 | 中 | 代碼分割，虛擬滾動，緩存優化 |
| 瀏覽器兼容性 | 中 | 低 | 使用Babel轉譯，Polyfill補丁 |

### 12.2 項目風險
| 風險 | 影響 | 概率 | 應對措施 |
|------|------|------|----------|
| 需求變更 | 高 | 中 | 敏捷開發，迭代交付 |
| 時間延期 | 高 | 中 | 合理排期，預留緩衝 |
| 人員變動 | 中 | 低 | 文檔完善，知識共享 |

## 13. 總結

本前端版面配置規劃書詳細描述了代理管理系統的前端設計方案，包括技術架構、頁面結構、組件設計、用戶體驗、性能優化等各個方面。通過遵循本規劃書，可以開發出一個功能完善、用戶友好、性能優異的代理管理前端系統。

關鍵成功因素：
1. **用戶體驗優先**: 始終以用戶需求為中心
2. **模塊化設計**: 便於維護和擴展
3. **性能優化**: 確保系統響應速度
4. **安全第一**: 重視數據安全和隱私保護
5. **持續改進**: 根據反饋不斷優化

通過系統化的設計和開發，本前端系統將為代理管理提供強大的支持，提升整體工作效率和用戶滿意度。